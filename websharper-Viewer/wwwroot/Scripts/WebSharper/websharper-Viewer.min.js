(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;a=self;b=a.Viewer=a.Viewer||{};c=b.Server=b.Server||{};d=c.Point=c.Point||{};e=b.topoJson=b.topoJson||{};f=e.topoJsonPointDetails=e.topoJsonPointDetails||{};g=e.topoJsonPoint=e.topoJsonPoint||{};h=e.topoJsonParentObject=e.topoJsonParentObject||{};i=b.Vector=b.Vector||{};j=i.Vector=i.Vector||{};k=b.Client=b.Client||{};l=k.windPoint=k.windPoint||{};m=a.WebSharper;n=m&&m.Obj;o=k.WindInterpolator=k.WindInterpolator||{};p=a["StartupCode$websharper-Viewer$Client"]=a["StartupCode$websharper-Viewer$Client"]||{};q=a.IntelliFactory;r=q&&q.Runtime;s=a.Math;t=m&&m.Arrays;u=m&&m.Collections;v=u&&u.Dictionary;w=a.JSON;x=m&&m.Remoting;y=x&&x.AjaxRemotingProvider;z=m&&m.UI;A=z&&z.Var$1;B=a.d3;C=B&&B.geo;D=z&&z.Submitter;E=B&&B.behavior;F=z&&z.View;G=m&&m.Concurrency;H=z&&z.Doc;I=z&&z.AttrProxy;J=m&&m.Operators;d=c.Point=r.Class({get_Test:function(){return 1;}},null,d);d.New=function(K,L,M){return new d({Lat:K,Long:L,WindSpeed:M});};f.New=function(K,L){return{type:K,coordinates:L};};g.New=function(K,L){return{type:K,geometry:L};};h.New=function(K,L){return{type:K,features:L};};j=i.Vector=r.Class({Project:function(K){return K([this.x,this.y]);},Add:function(K){return j.New(i.keepinbounds(this.x+K.x),i.keepinbounds(this.y+K.y));},Multiply:function(K){return j.New(this.x*K,this.y*K);},Scale:function(K){var L;L=K/this.get_Length();return j.New(this.x*L,this.y*L);},get_Length:function(){return s.sqrt(this.x*this.x+this.y*this.y);}},null,j);j.FromPolar=function(K,L){return j.New(K*s.cos(L),K*s.sin(L));};j.New=function(K,L){return new j({x:K,y:L});};i.keepinbounds=function(K){return K>180?K-360:K<180?K+360:K;};l=k.windPoint=r.Class({get_update:function(){return l.New(this.position.Add(this.velocity.Multiply(1)),this.velocity);}},null,l);l.New=function(K,L){return new l({position:K,velocity:L});};o=k.WindInterpolator=r.Class({get_Points:function(){return this.points;}},n,o);o.New=r.Ctor(function(K){var L,M,N,O,P;n.New.call(this);L=t.sort(t.distinct(t.map(function(Q){return Q.Lat;},K)));M=new v.New$5();t.iteri(function(Q,R){return M.Add(R,Q);},L);N=t.sort(t.distinct(t.map(function(Q){return Q.Long;},K)));O=new v.New$5();t.iteri(function(Q,R){return O.Add(R,Q);},N);P=t.zeroCreate2D(t.length(L),t.length(N));t.iter(function(Q){t.set2D(P,M.get_Item(Q.Lat),O.get_Item(Q.Long),j.New(Q.WindSpeed,0));},K);this.points=t.map(function(Q){return l.New(j.New(Q.Long/1000,Q.Lat/1000),j.New(Q.WindSpeed,1));},K);},o);k.Main=function(){var K,L,M,N,O,P,Q;K=w.parse((new y.New()).Sync("websharper-Viewer:Viewer.Server.GetWorld:-1635389890",[]));L=A.Create$1("");M=B.select("#map").append("svg").attr("width",2000).attr("height",500);N=M.append("g");N.append("path").datum(k.topojson().feature(K,K.objects.subunits)).attr("d",C.path().projection(k.projection()));O=D.CreateOption(L.get_View());P=(new y.New()).Sync("websharper-Viewer:Viewer.Server.GetWind:-2035211268",["Pacific.wind.7days.grb"]);C.path().projection(k.projection()).pointRadius(2);M.call(E.zoom().scaleExtent([1,8]).on("zoom",function(){N.attr("transform","translate("+B.event.translate+")scale("+B.event.scale+")");}));t.map(function(R){return g.New("Feature",f.New("Point",[R.Long/1000,R.Lat/1000]));},P);Q=F.MapAsync(function(R){var S,T,U;return R!=null&&R.$==1?(S=(new o.New(P)).get_Points(),(N.selectAll("line").data(S).enter().append("line").call(k.Animate),N.selectAll("circle").data(P).enter().append("circle").attr("cx",function(V){return((k.projection())([V.Long/1000,V.Lat/1000]))[0];}).attr("cy",function(V){return((k.projection())([V.Long/1000,V.Lat/1000]))[1];}).attr("fill",k.rgb).attr("r",function(){return"1px";}),T=null,G.Delay(function(){return G.Return("");}))):(U=null,G.Delay(function(){return G.Return("");}));},O.view);return H.Element("div",[],[H.Input([],L),H.Button("Send",[],function(){O.Trigger();}),H.Element("hr",[],[]),H.Element("h4",[I.Create("class","text-muted")],[H.TextNode("The server responded:")]),H.Element("div",[I.Create("class","jumbotron")],[H.Element("h1",[],[H.TextView(Q)])])]);};k.rgb=function(K){var L;L=J.toInt(K.WindSpeed);return((((r.Curried(function(M,N,O,P){return M("rgb("+a.String(N)+","+a.String(O)+","+a.String(P)+")");},4))(a.id))(L))(L))(L);};k.topojson=function(){p.$cctor();return p.topojson;};k.Animate=function(K){K.attr("x1",function(L){return(L.position.Project(k.projection()))[0];}).attr("y1",function(L){return(L.position.Project(k.projection()))[1];}).attr("x2",function(L){return(L.get_update().position.Project(k.projection()))[0];}).attr("y2",function(L){return(L.get_update().position.Project(k.projection()))[1];}).attr("stroke","black").style("opacity",0.5);};k.test=function(){p.$cctor();return p.test;};k.projection=function(){p.$cctor();return p.projection;};p.$cctor=function(){p.$cctor=a.ignore;p.projection=C.mercator().rotate([180,0,0]);p.test=d.New(1,1,1).get_Test();p.topojson=self.topojson;};}());

//# sourceMappingURL=websharper-Viewer.min.map