(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;a=self;b=a.Viewer=a.Viewer||{};c=b.Server=b.Server||{};d=c.Point=c.Point||{};e=b.topoJson=b.topoJson||{};f=e.topoJsonPointDetails=e.topoJsonPointDetails||{};g=e.topoJsonPoint=e.topoJsonPoint||{};h=e.topoJsonParentObject=e.topoJsonParentObject||{};i=b.Vector=b.Vector||{};j=i.Vector=i.Vector||{};k=b.Client=b.Client||{};l=k.windPoint=k.windPoint||{};m=a.WebSharper;n=m&&m.Obj;o=k.WindInterpolator=k.WindInterpolator||{};p=a["StartupCode$websharper-Viewer$Client"]=a["StartupCode$websharper-Viewer$Client"]||{};q=a.IntelliFactory;r=q&&q.Runtime;s=a.Math;t=m&&m.Arrays;u=m&&m.Collections;v=u&&u.Dictionary;w=a.JSON;x=m&&m.Remoting;y=x&&x.AjaxRemotingProvider;z=m&&m.UI;A=z&&z.Var$1;B=a.d3;C=B&&B.geo;D=z&&z.Submitter;E=B&&B.behavior;F=z&&z.View;G=m&&m.Random;H=m&&m.Concurrency;I=z&&z.Doc;J=z&&z.AttrProxy;K=m&&m.Operators;d=c.Point=r.Class({get_Test:function(){return 1;}},null,d);d.New=function(L,M,N){return new d({Lat:L,Long:M,WindSpeed:N});};f.New=function(L,M){return{type:L,coordinates:M};};g.New=function(L,M){return{type:L,geometry:M};};h.New=function(L,M){return{type:L,features:M};};j=i.Vector=r.Class({Project:function(L){return L([this.x,this.y]);},Add:function(L){return j.New(i.keepinbounds(this.x+L.x),i.keepinbounds(this.y+L.y));},Multiply:function(L){return j.New(this.x*L,this.y*L);},Scale:function(L){var M;M=L/this.get_Length();return j.New(this.x*M,this.y*M);},get_Length:function(){return s.sqrt(this.x*this.x+this.y*this.y);}},null,j);j.FromPolar=function(L,M){return j.New(L*s.cos(M),L*s.sin(M));};j.New=function(L,M){return new j({x:L,y:M});};i.keepinbounds=function(L){return L>180?L-360:L<180?L+360:L;};l=k.windPoint=r.Class({get_update:function(){return l.New(this.position.Add(this.velocity.Multiply(1)),this.velocity);}},null,l);l.New=function(L,M){return new l({position:L,velocity:M});};o=k.WindInterpolator=r.Class({get_Points:function(){return this.points;}},n,o);o.New=r.Ctor(function(L){var M,N,O,P,Q;n.New.call(this);M=t.sort(t.distinct(t.map(function(R){return R.Lat;},L)));N=new v.New$5();t.iteri(function(R,S){return N.Add(S,R);},M);O=t.sort(t.distinct(t.map(function(R){return R.Long;},L)));P=new v.New$5();t.iteri(function(R,S){return P.Add(S,R);},O);Q=t.zeroCreate2D(t.length(M),t.length(O));t.iter(function(R){t.set2D(Q,N.get_Item(R.Lat),P.get_Item(R.Long),j.New(R.WindSpeed,0));},L);this.points=t.map(function(R){return l.New(j.New(R.Long/1000,R.Lat/1000),j.New(R.WindSpeed,1));},L);},o);k.Main=function(){var L,M,N,O,P,Q,R;L=w.parse((new y.New()).Sync("websharper-Viewer:Viewer.Server.GetWorld:-1627845098",[]));M=A.Create$1("");N=B.select("#map").append("svg").attr("width",2000).attr("height",500);O=N.append("g");O.append("path").datum(k.topojson().feature(L,L.objects.subunits)).attr("d",C.path().projection(k.projection()));P=D.CreateOption(M.get_View());Q=(new y.New()).Sync("websharper-Viewer:Viewer.Server.GetWind:1230251650",["Pacific.wind.7days.grb"]);C.path().projection(k.projection()).pointRadius(2);N.call(E.zoom().scaleExtent([1,8]).on("zoom",function(){O.attr("transform","translate("+B.event.translate+")scale("+B.event.scale+")");}));t.map(function(S){return g.New("Feature",f.New("Point",[S.Long/1000,S.Lat/1000]));},Q);R=F.MapAsync(function(S){var T,U,V;return S!=null&&S.$==1?(new G.New(),T=t.filter(function(){return s.random()<0.1;},(new o.New(Q)).get_Points()),O.selectAll("line").data(T).enter().append("line").call(k.Animate),O.selectAll("circle").data(Q).enter().append("circle").attr("cx",function(W){return((k.projection())([W.Long/1000,W.Lat/1000]))[0];}).attr("cy",function(W){return((k.projection())([W.Long/1000,W.Lat/1000]))[1];}).attr("fill",k.rgb).attr("r",function(){return"0.3px";}),U=null,H.Delay(function(){return H.Return("");})):(V=null,H.Delay(function(){return H.Return("");}));},P.view);return I.Element("div",[],[I.Input([],M),I.Button("Send",[],function(){P.Trigger();}),I.Element("hr",[],[]),I.Element("h4",[J.Create("class","text-muted")],[I.TextNode("The server responded:")]),I.Element("div",[J.Create("class","jumbotron")],[I.Element("h1",[],[I.TextView(R)])])]);};k.rgb=function(L){var M;M=K.toInt(L.WindSpeed);return((((r.Curried(function(N,O,P,Q){return N("rgb("+a.String(O)+","+a.String(P)+","+a.String(Q)+")");},4))(a.id))(M))(M))(M);};k.topojson=function(){p.$cctor();return p.topojson;};k.Animate=function(L){var M;function N(O){var P,Q,R,S,T,U;P=O.position.Project(k.projection());Q=P[1];R=P[0];S=O.get_update().position.Project(k.projection());T=S[1];U=S[0];return s.sqrt((R-U)*(R-U)+(Q-T)*(Q-T));}(M=L.attr("x1",function(O){return(O.position.Project(k.projection()))[0];}).attr("y1",function(O){return(O.position.Project(k.projection()))[1];}).attr("x2",function(O){return(O.get_update().position.Project(k.projection()))[0];}).attr("y2",function(O){return(O.get_update().position.Project(k.projection()))[1];}).attr("stroke","black").attr("stroke-dasharray",function(O){var P,Q;P=(Q=N(O),a.String(Q));return P+" "+P;}).attr("stroke-dashoffset",N).transition().duration(2000),M.ease.apply(M,["linear"])).attr("stroke-dashoffset",0);};k.test=function(){p.$cctor();return p.test;};k.projection=function(){p.$cctor();return p.projection;};p.$cctor=function(){p.$cctor=a.ignore;p.projection=C.mercator().rotate([180,0,0]);p.test=d.New(1,1,1).get_Test();p.topojson=self.topojson;};}());

//# sourceMappingURL=websharper-Viewer.min.map