{
"version": 3,
"sourceRoot": "Source",
"sources": ["websharper-Viewer/Client.fs"],
"sourcesContent": ["namespace websharper_Viewer\n\nopen WebSharper\nopen WebSharper.JavaScript\nopen WebSharper.UI\nopen WebSharper.UI.Client\nopen WebSharper.UI.Html\nopen WebSharper.D3\n[<JavaScript>]\nmodule Client =\n    type topoJsonPointDetails = \n        {\n            ``type``: string;\n            coordinates : double[];\n        }\n    type topoJsonPoint=\n        {\n            ``type`` : string;\n            geometry : topoJsonPointDetails\n        }\n   \n    type topoJsonParentObject =\n        {\n            ``type``: string;\n            features : topoJsonPoint[];\n        }\n    [<Name \"\">]\n    type ITopoJson =\n        abstract feature : topology: obj * geoObject: obj -> obj\n        abstract mesh : topology: obj * geoObject: obj * filter: (obj * obj -> bool) -> obj\n        //This doesn't compile - how to fix???????????\n\n\n    let topojson : ITopoJson =\n        JS.Global?topojson\n    let projection = D3.Geo.Mercator()\n    let Main () =\n        let world = WebSharper.Json.Parse <| Server.GetWorld()\n        let rvInput = Var.Create \"\"\n\n        let width = 500\n        let height = 500\n        let svg = D3.Select(\"#map\").Append(\"svg\")\n                    .Attr(\"width\", width)\n                    .Attr(\"height\", height)\n\n        let g = svg.Append(\"g\"); //not sure what the g is for\n        g.Append(\"path\")\n            .Datum(topojson.feature(world, world?objects?subunits))\n            .Attr(\"d\", D3.Geo.Path().Projection(projection)) |> ignore \n        let submit = Submitter.CreateOption rvInput.View\n        let data = Server.GetWind \"Pacific.wind.7days.grb\"\n        let path = D3.Geo.Path().Projection(projection).PointRadius(2.)\n\n   //     let zoom =new System.Action<_>(fun  _ -> g.Attr(\"transform\", \"translate(\"+D3.Event?translate+\")\") |> ignore)\n     //   svg.Call(zoom) |> ignore\n        let TopoJsonData = \n            {\n                ``type`` = \"FeatureCollection\";\n                features = data |> Array.map (fun p ->\n                    {\n                        ``type`` = \"Feature\";\n                        geometry =\n                            {\n                                ``type`` = \"Point\" ;\n                                coordinates = [|p.Long/1000.0;p.Lat/1000.0|]\n                            }               \n                    })\n            }\n        let vReversed =\n            submit.View.MapAsync(function\n                | None -> async { return \"\" }\n                | Some input -> \n                    g.Append(\"path\")\n                        .Datum(TopoJsonData)\n                        .Attr(\"d\", path) |> ignore\n                    async {return \"\"}\n            )\n        div [] [\n            Doc.Input [] rvInput\n            Doc.Button \"Send\" [] submit.Trigger\n            hr [] []\n            h4 [attr.``class`` \"text-muted\"] [text \"The server responded:\"]\n            div [attr.``class`` \"jumbotron\"] [h1 [] [textView vReversed]]\n        ]\n"],
"names": [],
"mappings": "8vB,AAqCoB,QAAyB,wFAAiB,C,AAAA,G,AACxC,WAAW,EAAE,C,AAAA,G,AAIjB,SAAU,MAAM,C,AAAC,Q,AAAQ,KAAK,C,AAAC,M,AACvB,OAAO,C,AAAE,GAAK,C,AAAC,M,AACf,QAAQ,C,AAAE,GAAM,C,AAEvB,Q,AAAQ,GAAG,C,AAAC,C,AACvB,CAAC,Q,AAAQ,MAAM,C,AAAC,O,AACL,YAAQ,S,AAAS,CAAK,C,AAAE,CAAK,Q,AAAQ,S,AAAS,C,AAAC,C,AAAC,M,AACjD,GAAG,C,AAAE,QAAa,Y,AAAY,cAAU,C,AAAC,C,AAAW,G,AACjD,eAAuB,CAAO,W,AAAK,C,AAAA,G,AACrC,oFAAe,wBAAwB,E,AAAA,G,AACvC,QAAa,Y,AAAY,cAAU,C,AAAC,a,AAAa,CAAE,C,AAAC,G,AAK3D,MACe,mBAAmB,C,AACnB,MAAQ,mBACf,MACe,SAAS,C,AAEhB,MACe,OAAO,C,AACJ,CAAE,CAAM,K,AAAA,C,AAAC,IAAM,C,AAAC,CAAK,I,AAAA,C,AAAC,IAAM,C,AAAE,C,AAC/C,C,AACR,E,AAAC,C,AARa,CAQb,C,AAAA,C,AACT,G,AAED,WAAqB,2BAAA,eAAQ,E,AAGrB,CAAC,Q,AAAQ,MAAM,C,AAAC,O,AACL,CAAY,C,AAAC,M,AACd,GAAG,C,AAAE,CAAI,C,AAAW,G,AAC9B,IAAK,S,AAAE,kBAAA,SAAO,EAAE,C,AAAA,E,AAAA,C,AANK,G,AAAR,EACP,IAAK,C,AAAL,QAAQ,kBAAA,SAAO,EAAE,C,AAAA,E,AAAA,C,AAAZ,C,AAKM,E,AAAA,C,AANzB,CAAM,K,AAAK,C,AAOV,4B,AAED,WAAa,CAAO,C,AAAA,C,AACpB,SAAW,MAAM,I,AAAI,WAAA,CAAc,U,AAAA,E,AAAA,C,AAAA,C,AACnC,qBAAQ,C,AACR,gBAAI,iBAAe,YAAY,C,AAAA,G,AAAG,WAAK,uBAAuB,C,AAAA,E,AAAC,C,AAC/D,iBAAK,iBAAe,WAAW,C,AAAA,G,AAAG,mBAAO,WAAS,CAAS,C,AAAA,E,AAAC,E,AAAC,oK,AAjDjE,IAAS,S,AAAS,c,AACL,YAAiB,Q;"
}
